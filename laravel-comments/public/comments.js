!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.Comments=n():e.Comments=n()}("undefined"!=typeof self?self:this,function(){return function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=2)}({"+MGj":function(e,n,t){var i,o,r;"function"==typeof Symbol&&Symbol.iterator;o=[],i=function(){"use strict";if("undefined"==typeof window||!("document"in window))return{};var e=function(e,n,t){var i;n=n||999,t||0===t||(t=9);var o=function(e){i=e},r=function(){clearTimeout(i),o(0)},a=function(n){return Math.max(0,e.getTopOf(n)-t)},c=function(t,i,a){if(r(),0===i||i&&i<0||(l=e.body,"getComputedStyle"in window&&"smooth"===window.getComputedStyle(l)["scroll-behavior"]))e.toY(t),a&&a();else{var c=e.getY(),s=Math.max(0,t)-c,u=(new Date).getTime();i=i||Math.min(Math.abs(s),n),function n(){o(setTimeout(function(){var t=Math.min(1,((new Date).getTime()-u)/i),o=Math.max(0,Math.floor(c+s*(t<.5?2*t*t:t*(4-2*t)-1)));e.toY(o),t<1&&e.getHeight()+o<e.body.scrollHeight?n():(setTimeout(r,99),a&&a())},9))}()}var l},s=function(e,n,t){c(a(e),n,t)};return{setup:function(e,i){return(0===e||e)&&(n=e),(0===i||i)&&(t=i),{defaultDuration:n,edgeOffset:t}},to:s,toY:c,intoView:function(n,i,o){var r=n.getBoundingClientRect().height,u=e.getTopOf(n)+r,l=e.getHeight(),f=e.getY(),d=f+l;a(n)<f||r+t>l?s(n,i,o):u+t>d?c(u-l+t,i,o):o&&o()},center:function(n,t,i,o){c(Math.max(0,e.getTopOf(n)-e.getHeight()/2+(i||n.getBoundingClientRect().height/2)),t,o)},stop:r,moving:function(){return!!i},getY:e.getY,getTopOf:e.getTopOf}},n=document.documentElement,t=function(){return window.scrollY||n.scrollTop},i=e({body:document.scrollingElement||document.body,toY:function(e){window.scrollTo(0,e)},getY:t,getHeight:function(){return window.innerHeight||n.clientHeight},getTopOf:function(e){return e.getBoundingClientRect().top+t()-n.offsetTop}});return i.createScroller=function(t,i,o){return e({body:t,toY:function(e){t.scrollTop=e},getY:function(){return t.scrollTop},getHeight:function(){return Math.min(t.clientHeight,window.innerHeight||n.clientHeight)},getTopOf:function(e){return e.offsetTop}},i,o)},i}(),void 0===(r="function"==typeof i?i.apply(n,o):i)||(e.exports=r)},2:function(e,n,t){e.exports=t("xghT")},WzHq:function(e,n,t){"use strict";function i(e,n,t){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp((t?"[\\#]":"[\\?&]")+n+"=([^&#]*)").exec(e);return i?decodeURIComponent(i[1].replace(/\+/g," ")):void 0}n.a=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=i(window.location.search,"_escaped_fragment_");return+i(t?"#"+t:window.location.hash.replace("#!","#"),e,!0)||n}},Z27y:function(e,n,t){var i,o,r;!function(t){"use strict";if("undefined"!=typeof window){var a,c=0,s=!1,u=!1,l="message".length,f="[iFrameSizer]",d=f.length,m=null,g=window.requestAnimationFrame,p={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},h={},w=null,b={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){M("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};window.jQuery&&((a=window.jQuery).fn?a.fn.iFrameResize||(a.fn.iFrameResize=function(e){return this.filter("iframe").each(function(n,t){Y(t,e)}).end()}):T("","Unable to bind to jQuery, it is not fully loaded.")),o=[],(r="function"==typeof(i=B)?i.apply(n,o):i)===t||(e.exports=r)}function y(e,n,t){"addEventListener"in window?e.addEventListener(n,t,!1):"attachEvent"in window&&e.attachEvent("on"+n,t)}function v(e,n,t){"removeEventListener"in window?e.removeEventListener(n,t,!1):"detachEvent"in window&&e.detachEvent("on"+n,t)}function x(e){return f+"["+(t="Host page: "+(n=e),window.top!==window.self&&(t=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+n:"Nested host page: "+n),t)+"]";var n,t}function k(e){return h[e]?h[e].log:s}function O(e,n){C("log",e,n,k(e))}function T(e,n){C("info",e,n,k(e))}function M(e,n){C("warn",e,n,!0)}function C(e,n,t,i){!0===i&&"object"==typeof window.console&&console[e](x(n),t)}function I(e){function n(){t("Height"),t("Width"),P(function(){S(k),z(C),s("resizedCallback",k)},k,"init")}function t(e){var n=Number(h[C]["max"+e]),t=Number(h[C]["min"+e]),i=e.toLowerCase(),o=Number(k[i]);O(C,"Checking "+i+" is in range "+t+"-"+n),o<t&&(o=t,O(C,"Set "+i+" to min value")),o>n&&(o=n,O(C,"Set "+i+" to max value")),k[i]=""+o}function i(e){return x.substr(x.indexOf(":")+l+e)}function o(e,n){q(function(){var t,i;W("Send Page Info","pageInfo:"+(t=document.body.getBoundingClientRect(),i=k.iframe.getBoundingClientRect(),JSON.stringify({iframeHeight:i.height,iframeWidth:i.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(i.top-t.top,10),offsetLeft:parseInt(i.left-t.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset})),e,n)},32)}function r(e){var n=e.getBoundingClientRect();return R(C),{x:Math.floor(Number(n.left)+Number(m.x)),y:Math.floor(Number(n.top)+Number(m.y))}}function a(e){var n=e?r(k.iframe):{x:0,y:0},t={x:Number(k.width)+n.x,y:Number(k.height)+n.y};O(C,"Reposition requested from iFrame (offset x:"+n.x+" y:"+n.y+")"),window.top!==window.self?window.parentIFrame?window.parentIFrame["scrollTo"+(e?"Offset":"")](t.x,t.y):M(C,"Unable to scroll to requested position, window.parentIFrame not found"):(m=t,c(),O(C,"--"))}function c(){!1!==s("scrollCallback",m)?z(C):H()}function s(e,n){return F(C,e,n)}var u,g,p,w,b,x=e.data,k={},C=null;"[iFrameResizerChild]Ready"===x?function(){for(var e in h)W("iFrame requested init",N(e),document.getElementById(e),e)}():f===(""+x).substr(0,d)&&x.substr(d).split(":")[0]in h?(b=x.substr(d).split(":"),k={iframe:h[b[0]]&&h[b[0]].iframe,id:b[0],height:b[1],width:b[2],type:b[3]},C=k.id,h[C]&&(h[C].loaded=!0),(w=k.type in{true:1,false:1,undefined:1})&&O(C,"Ignoring init message from meta parent page"),!w&&(p=!0,h[g=C]||(p=!1,M(k.type+" No settings for "+g+". Message was: "+x)),p)&&(O(C,"Received: "+x),u=!0,null===k.iframe&&(M(C,"IFrame ("+k.id+") not found"),u=!1),u&&function(){var n,t=e.origin,i=h[C]&&h[C].checkOrigin;if(i&&""+t!="null"&&!(i.constructor===Array?function(){var e=0,n=!1;for(O(C,"Checking connection is from allowed list of origins: "+i);e<i.length;e++)if(i[e]===t){n=!0;break}return n}():(n=h[C]&&h[C].remoteHost,O(C,"Checking connection is from: "+n),t===n)))throw new Error("Unexpected message received from: "+t+" for "+k.iframe.id+". Message was: "+e.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}()&&function(){switch(h[C]&&h[C].firstRun&&h[C]&&(h[C].firstRun=!1),k.type){case"close":h[C].closeRequestCallback?F(C,"closeRequestCallback",h[C].iframe):E(k.iframe);break;case"message":d=i(6),O(C,"MessageCallback passed: {iframe: "+k.iframe.id+", message: "+d+"}"),s("messageCallback",{iframe:k.iframe,message:JSON.parse(d)}),O(C,"--");break;case"scrollTo":a(!1);break;case"scrollToOffset":a(!0);break;case"pageInfo":o(h[C]&&h[C].iframe,C),function(){function e(e,i){function r(){h[t]?o(h[t].iframe,t):n()}["scroll","resize"].forEach(function(n){O(t,e+n+" listener for sendPageInfo"),i(window,n,r)})}function n(){e("Remove ",v)}var t=C;e("Add ",y),h[t]&&(h[t].stopPageInfo=n)}();break;case"pageInfoStop":h[C]&&h[C].stopPageInfo&&(h[C].stopPageInfo(),delete h[C].stopPageInfo);break;case"inPageLink":e=i(9),u=e.split("#")[1]||"",l=decodeURIComponent(u),(f=document.getElementById(l)||document.getElementsByName(l)[0])?(t=r(f),O(C,"Moving to in page link (#"+u+") at x: "+t.x+" y: "+t.y),m={x:t.x,y:t.y},c(),O(C,"--")):window.top!==window.self?window.parentIFrame?window.parentIFrame.moveToAnchor(u):O(C,"In page link #"+u+" not found and window.parentIFrame not found"):O(C,"In page link #"+u+" not found");break;case"reset":j(k);break;case"init":n(),s("initCallback",k.iframe);break;default:n()}var e,t,u,l,f,d}())):T(C,"Ignored: "+x)}function F(e,n,t){var i=null,o=null;if(h[e]){if("function"!=typeof(i=h[e][n]))throw new TypeError(n+" on iFrame["+e+"] is not a function");o=i(t)}return o}function E(e){var n=e.id;O(n,"Removing iFrame: "+n),e.parentNode&&e.parentNode.removeChild(e),F(n,"closedCallback",n),O(n,"--"),delete h[n]}function R(e){null===m&&O(e,"Get page position: "+(m={x:window.pageXOffset!==t?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==t?window.pageYOffset:document.documentElement.scrollTop}).x+","+m.y)}function z(e){null!==m&&(window.scrollTo(m.x,m.y),O(e,"Set page position: "+m.x+","+m.y),H())}function H(){m=null}function j(e){O(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),R(e.id),P(function(){S(e),W("reset","reset",e.iframe,e.id)},e,"reset")}function S(e){function n(n){u||"0"!==e[n]||(u=!0,O(i,"Hidden iFrame detected, creating visibility listener"),function(){function e(){function e(e){function n(n){return"0px"===(h[e]&&h[e].iframe.style[n])}h[e]&&null!==h[e].iframe.offsetParent&&(n("height")||n("width"))&&W("Visibility change","resize",h[e].iframe,e)}for(var n in h)e(n)}function n(n){O("window","Mutation observed: "+n[0].target+" "+n[0].type),q(e,16)}var t=window.MutationObserver||window.WebKitMutationObserver;t&&(i=document.querySelector("body"),new t(n).observe(i,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0}));var i}())}function t(t){var o;o=t,e.iframe.style[o]=e[o]+"px",O(e.id,"IFrame ("+i+") "+o+" set to "+e[o]+"px"),n(t)}var i=e.iframe.id;h[i]&&(h[i].sizeHeight&&t("height"),h[i].sizeWidth&&t("width"))}function P(e,n,t){t!==n.type&&g?(O(n.id,"Requesting animation frame"),g(e)):e()}function W(e,n,t,i,o){var r,a=!1;i=i||t.id,h[i]&&(t&&"contentWindow"in t&&null!==t.contentWindow?(r=h[i]&&h[i].targetOrigin,O(i,"["+e+"] Sending msg to iframe["+i+"] ("+n+") targetOrigin: "+r),t.contentWindow.postMessage(f+n,r)):M(i,"["+e+"] IFrame("+i+") not found"),o&&h[i]&&h[i].warningTimeout&&(h[i].msgTimeout=setTimeout(function(){!h[i]||h[i].loaded||a||(a=!0,M(i,"IFrame has not responded within "+h[i].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ingored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},h[i].warningTimeout)))}function N(e){return e+":"+h[e].bodyMarginV1+":"+h[e].sizeWidth+":"+h[e].log+":"+h[e].interval+":"+h[e].enablePublicMethods+":"+h[e].autoResize+":"+h[e].bodyMargin+":"+h[e].heightCalculationMethod+":"+h[e].bodyBackground+":"+h[e].bodyPadding+":"+h[e].tolerance+":"+h[e].inPageLinks+":"+h[e].resizeFrom+":"+h[e].widthCalculationMethod}function Y(e,n){var i,o,r,a,u,l=(i=e.id,i,""===i&&(e.id=(o=n&&n.id||b.id+c++,null!==document.getElementById(o)&&(o+=c++),i=o),s=(n||{}).log,i,O(i,"Added missing iframe ID: "+i+" ("+e.src+")")),i);l in h&&"iFrameResizer"in e?M(l,"Ignored iFrame, already setup."):(a=(a=n)||{},h[l]={firstRun:!0,iframe:e,remoteHost:e.src.split("/").slice(0,3).join("/")},function(e){if("object"!=typeof e)throw new TypeError("Options is not an object")}(a),function(e){for(var n in b)b.hasOwnProperty(n)&&(h[l][n]=e.hasOwnProperty(n)?e[n]:b[n])}(a),h[l]&&(h[l].targetOrigin=!0===h[l].checkOrigin?""===(u=h[l].remoteHost)||"file://"===u?"*":u:"*"),function(){switch(O(l,"IFrame scrolling "+(h[l]&&h[l].scrolling?"enabled":"disabled")+" for "+l),e.style.overflow=!1===(h[l]&&h[l].scrolling)?"hidden":"auto",h[l]&&h[l].scrolling){case!0:e.scrolling="yes";break;case!1:e.scrolling="no";break;default:e.scrolling=h[l]?h[l].scrolling:"no"}}(),function(){function n(n){1/0!==h[l][n]&&0!==h[l][n]&&(e.style[n]=h[l][n]+"px",O(l,"Set "+n+" = "+h[l][n]+"px"))}function t(e){if(h[l]["min"+e]>h[l]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}t("Height"),t("Width"),n("maxHeight"),n("minHeight"),n("maxWidth"),n("minWidth")}(),"number"!=typeof(h[l]&&h[l].bodyMargin)&&"0"!==(h[l]&&h[l].bodyMargin)||(h[l].bodyMarginV1=h[l].bodyMargin,h[l].bodyMargin=h[l].bodyMargin+"px"),r=N(l),y(e,"load",function(){var n,i;W("iFrame.onload",r,e,t,!0),n=h[l]&&h[l].firstRun,i=h[l]&&h[l].heightCalculationMethod in p,!n&&i&&j({iframe:e,height:0,width:0,type:"init"})}),W("init",r,e,t,!0),Function.prototype.bind&&h[l]&&(h[l].iframe.iFrameResizer={close:E.bind(null,h[l].iframe),resize:W.bind(null,"Window resize","resize",h[l].iframe),moveToAnchor:function(e){W("Move to anchor","moveToAnchor:"+e,h[l].iframe,l)},sendMessage:function(e){W("Send Message","message:"+(e=JSON.stringify(e)),h[l].iframe,l)}}))}function q(e,n){null===w&&(w=setTimeout(function(){w=null,e()},n))}function L(e){O("window","Trigger event: "+e),q(function(){A("Window "+e,"resize")},16)}function _(){"hidden"!==document.visibilityState&&(O("document","Trigger event: Visiblity change"),q(function(){A("Tab Visable","resize")},16))}function A(e,n){for(var t in h)h[i=t]&&"parent"===h[i].resizeFrom&&h[i].autoResize&&!h[i].firstRun&&W(e,n,document.getElementById(t),t);var i}function B(){function e(e,t){t&&(!function(){if(!t.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==t.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+t.tagName+">")}(),Y(t,e),n.push(t))}var n;return function(){var e,n=["moz","webkit","o","ms"];for(e=0;e<n.length&&!g;e+=1)g=window[n[e]+"RequestAnimationFrame"];g||O("setup","RequestAnimationFrame not supported")}(),y(window,"message",I),y(window,"resize",function(){L("resize")}),y(document,"visibilitychange",_),y(document,"-webkit-visibilitychange",_),y(window,"focusin",function(){L("focus")}),y(window,"focus",function(){L("focus")}),function(i,o){var r;switch(n=[],(r=i)&&r.enablePublicMethods&&M("enablePublicMethods option has been removed, public methods are now always available in the iFrame"),typeof o){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(o||"iframe"),e.bind(t,i));break;case"object":e(i,o);break;default:throw new TypeError("Unexpected data type ("+typeof o+")")}return n}}}()},ZWYU:function(e,n,t){"use strict";n.a=function(e){return Object.keys(e).map(function(n){var t=e[n];return void 0===t?"":null===t?i(n):i(n)+"="+i(t)}).filter(function(e){return e.length>0}).join("&")};var i=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}},mCbk:function(e,n,t){"use strict";n.a=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;o.a[isNaN(e)?"to":"toY"](e,n)};var i=t("+MGj"),o=t.n(i)},xghT:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("mCbk"),o=t("WzHq"),r=t("ZWYU"),a=t("Z27y"),c=t.n(a),s=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},u=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();var l=function(){function e(n){var t=n.el,i=function(e,n){var t={};for(var i in e)n.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}(n,["el"]);!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.el=t;if(this.options=s({},{url:"/comments"},i),"string"==typeof this.el&&(this.el=document.querySelector(this.el)),!this.el)throw new Error("[comments] Element not found.");this.el.innerHTML="",this.initSpinner(),this.initIframe()}return u(e,[{key:"initSpinner",value:function(){this.spinner=document.createElement("div"),this.spinner.classList.add("comments__spinner"),this.el.appendChild(this.spinner)}},{key:"initIframe",value:function(){var e=this;this.iframe=document.createElement("iframe"),this.iframe.scrolling="no",this.iframe.src=this.buildUrl(),this.iframe.classList.add("comments__iframe"),this.iframe.onload=function(){e.spinner.style.display="none",e.iframe.style.opacity=1},this.el.appendChild(this.iframe),c()({messageCallback:function(e){var n=e.iframe,t=e.message,o=t.type,r=t.position;if("scroll"===o){var a=n.getBoundingClientRect(),c=window.pageYOffset||document.documentElement.scrollTop;setTimeout(function(){Object(i.a)(r+a.top+c)},50)}}},this.iframe)}},{key:"buildUrl",value:function(){var e=this.options,n=e.data?"function"==typeof e.data?e.data():e.data:{},t=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),i=e.permalink||(location.origin||t)+location.pathname+location.search,a=s({},n,{permalink:i,order:e.order,page_id:e.pageId,per_page:e.perPage,page:Object(o.a)("page"),target:Object(o.a)("comment"),commentable_id:e.commentableId,commentable_type:e.commentableType});return e.url+(e.url.indexOf("?")>-1?"&":"?")+Object(r.a)(a)}}]),e}();n.default=l}})});
//# sourceMappingURL=comments.js.map